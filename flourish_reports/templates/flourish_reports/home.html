{% extends 'edc_base/base.html' %}

{% load static %}
{% load crispy_forms_tags %}
{% load follow_extras %}
{% block extra-scripts %}
	{{ block.super }}
	<script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.13/js/dataTables.bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.13/css/dataTables.bootstrap.min.css">
	<script type="text/javascript">
	$(document).ready(function() {
	    $('#item-identifiers').DataTable();
	} );
	</script>

	<script type="text/javascript">

	  jQuery(function() {
	    jQuery('#users').change(function() {
	        this.form.submit();
	    });
	});
	</script>
{% endblock extra-scripts %}


{% block main %}
<div class="container">
	<h2>Flourish Reports</h2>
	  <p>Select a tab for the report you want.</p>
	
	  <ul class="nav nav-tabs">
	    <li class="active"><a data-toggle="tab" href="#recruitment">Recruitment</a></li>
	    <li><a data-toggle="tab" href="#management">Management</a></li>
	    <li><a data-toggle="tab" href="#enrolment">Enrolments</a></li>
	    <li><a data-toggle="tab" href="#lab">Lab</a></li>
	  </ul>
	
	  <div class="tab-content">
	    <div id="recruitment" class="tab-pane fade in active">
	    <br>
	    {% csrf_token %}
		{% crispy form %}
	    <br>
	    <div class="panel panel-info">
	      <div class="panel-heading">
	      <h4>FLOURISH Recruitment Productivity Report</h4>
	      </div>
	      <div class="panel-body">
		      <table class="table table-hover">
			    <thead>
			      <tr>
			        <th>Staff Member Name</th>
			        <th># of attempted participants contacts</th>
			        <th># of attempted contacts</th>
			        <th># reached</th>
			        <th># accepting</th>
			        <th>conversion</th>
			        <th>conversion %</th>
			      </tr>
			    </thead>
			    <tbody>
			    {% for r in recruitment.1 %}
			      <tr>
			      	{% for v in r %}
			        <td>{{v}}</td>
			        {% endfor %}
			      </tr>
			      {% endfor %}
			      <tr>
			        <td><b>Totals </b></td>
			        <td><b>{{ recruitment.0.0 }}</b></td>
			        <td><b>{{ recruitment.0.1 }}</b></td>
			        <td><b>{{ recruitment.0.2 }}</b></td>
			        <td><b>{{ recruitment.0.3 }}</b></td>
			        <td><b>{{ recruitment.0.4 }}</b></td>
			        <td><b></b></td>
			      </tr>

			    </tbody>
			  </table>
			</div>
	    </div>
	    {% if recruitment_downloads %}
			<div class="panel panel-info">
				<div class="panel-heading">
					<h4>Recruitment Report Downloads</h4>
				</div>
				<div class="panel-body">
				<table id="item-identifiers" class="table table-striped table-bordered" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Export identifier</th>
							<th>Document</th>
							<th>Report data range</th>
							<th>Datetime generated</th>
						</tr>
					</thead>
					<tfoot>
						<tr>
							<th>Export identifier</th>
							<th>Document</th>
							<th>Report data range</th>
							<th>Datetime generated</th>
						</tr>
					</tfoot>
					<tbody>
						{% for download in recruitment_downloads %}
						<tr>
					 		<td>{{ download.export_identifier }}</td>
					 		<td>
					 			{% if download.document.url %}
					 				<a href={{ download.file_url }}><i class="fa fa-download fa-sm"></i> file download</a>
					 			{% endif %}
					 		</td>
					 		<td>{{ download.start_date }} & {{ download.end_date }}</td>
					 		<td>{{ download.uploaded_at }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		{% endif %}
	    </div>
	    <div id="management" class="tab-pane fade">
	      <h3>Management report</h3>
	      <br>
	      <div class="panel panel-info">
		     <div class="panel-heading">Generate report</div>
		     <div class="panel-body">
		     	<form method="post">
				    {% csrf_token %}
				    <div class="form-row">
				      <div class="form-group col-md-2 mb-0">
				        {{ form.start_date|as_crispy_field }}
				      </div>
				      <div class="form-group col-md-2 mb-0">
				        {{ form.end_date|as_crispy_field }}
				      </div>
				      <div class="form-group col-md-2 mb-0">
				      <button class="btn btn-primary" type="submit" value="Submit" name="mdownload_report" ><i class="fa fa-lg fa-floppy-o"></i> download report</button> 
				      </div>
				    </div>
				  </form>	
		     </div>
		   </div>
		 <br>
			{% if management_report_downloads %}
			<div class="panel panel-info">
				<div class="panel-heading">
					<h4>Management Report Downloads</h4>
				</div>
				<div class="panel-body">
				<table id="item-identifiers" class="table table-striped table-bordered" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Export identifier</th>
							<th>Document</th>
							<th>Report data range</th>
							<th>Datetime generated</th>
						</tr>
					</thead>
					<tfoot>
						<tr>
							<th>Export identifier</th>
							<th>Document</th>
							<th>Report data range</th>
							<th>Datetime generated</th>
						</tr>
					</tfoot>
					<tbody>
						{% for download in management_report_downloads %}
						<tr>
					 		<td>{{ download.export_identifier }}</td>
					 		<td>
					 			{% if download.document.url %}
					 				<a href={{ download.file_url }}><i class="fa fa-download fa-sm"></i> file download</a>
					 			{% endif %}
					 		</td>
					 		<td>{{ download.start_date }} & {{ download.end_date }}</td>
					 		<td>{{ download.uploaded_at }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		{% endif %}
	    <div id="enrolment" class="tab-pane fade">
	      <h3>Enrolment report</h3>
	      <p>Still under construction.</p>
	    </div>
	    <div id="lab" class="tab-pane fade">
	      <h3>Lab report</h3>
	      <p>Still under construction.</p>
	    </div>
</div>
</div>
{% endblock main %}
